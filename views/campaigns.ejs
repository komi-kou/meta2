<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ç®¡ç† - Metaåºƒå‘Šãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f6fa;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 20px;
            background: rgba(0,0,0,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 500;
        }
        
        .sidebar-nav {
            padding: 10px 0;
        }
        
        .nav-item {
            display: block;
            padding: 12px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s;
            position: relative;
        }
        
        .nav-item:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        .nav-item.active {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #fff;
        }
        
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .content-header {
            margin-bottom: 30px;
        }
        
        .content-title {
            font-size: 28px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .campaigns-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .filter-section select, .filter-section input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .campaigns-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .campaigns-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-size: 13px;
            color: #6c757d;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }
        
        .campaigns-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
            font-size: 14px;
        }
        
        .campaigns-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-badge.active {
            background: #d4edda;
            color: #155724;
        }
        
        .status-badge.paused {
            background: #fff3cd;
            color: #856404;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .btn-sm {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-edit {
            background: #28a745;
            color: white;
        }
        
        .btn-pause {
            background: #ffc107;
            color: #333;
        }
        
        .btn-delete {
            background: #dc3545;
            color: white;
        }
        
        .budget-input {
            width: 100px;
            padding: 4px 8px;
            border: 1px solid #28a745;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .budget-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .bulk-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .checkbox-column {
            width: 30px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 500px;
            max-width: 90%;
        }
        
        .modal-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #495057;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>Metaåºƒå‘Šãƒ¬ãƒãƒ¼ãƒˆ</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="/dashboard" class="nav-item">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
                <a href="/campaigns" class="nav-item active">ğŸ“Š ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ç®¡ç†</a>
                <a href="/ad-performance" class="nav-item">ğŸ¯ åºƒå‘Šãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</a>
                <a href="/audience-analysis" class="nav-item">ğŸ‘¥ ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹åˆ†æ</a>
                <a href="/multi-account" class="nav-item">ğŸ”„ ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</a>
                <a href="/budget-scheduling" class="nav-item">â° äºˆç®—ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°</a>
                <a href="/alerts" class="nav-item" id="alerts-link">ã‚¢ãƒ©ãƒ¼ãƒˆå†…å®¹</a>
                <a href="/alert-history" class="nav-item">ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´</a>
                <a href="/improvement-tasks" class="nav-item">ç¢ºèªäº‹é …</a>
                <a href="/improvement-strategies" class="nav-item">æ”¹å–„æ–½ç­–</a>
            
            <div class="sidebar-footer" style="position: absolute; bottom: 20px; left: 0; right: 0; padding: 0 20px;">
                <form action="/logout" method="POST" style="margin: 0;">
                    <button type="submit" class="nav-item" style="
                        display: block;
                        width: 100%;
                        padding: 12px 20px;
                        background: rgba(231, 76, 60, 0.1);
                        color: #e74c3c;
                        border: 1px solid rgba(231, 76, 60, 0.2);
                        border-radius: 5px;
                        text-align: left;
                        cursor: pointer;
                        transition: all 0.3s;
                        font-size: 14px;
                        font-weight: 500;
                    " onmouseover="this.style.background='rgba(231, 76, 60, 0.2)'" onmouseout="this.style.background='rgba(231, 76, 60, 0.1)'">
                        ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                    </button>
                </form>
            </div>
        </div>
        
        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="main-content">
            <div class="content-header">
                <h1 class="content-title">ğŸ“Š ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ç®¡ç†</h1>
                <p style="color: #6c757d;">ã™ã¹ã¦ã®ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã®äºˆç®—ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç®¡ç†ã—ã¾ã™</p>
            </div>
            
            <div class="campaigns-container">
                <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="filter-section">
                    <select id="statusFilter">
                        <option value="all">ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
                        <option value="ACTIVE">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</option>
                        <option value="PAUSED">ä¸€æ™‚åœæ­¢</option>
                    </select>
                    <select id="periodFilter">
                        <option value="last_7d">éå»7æ—¥é–“</option>
                        <option value="last_30d">éå»30æ—¥é–“</option>
                        <option value="this_month">ä»Šæœˆ</option>
                        <option value="lifetime">å…¨æœŸé–“</option>
                    </select>
                    <button class="btn-primary" onclick="loadCampaigns()">æ›´æ–°</button>
                    <button class="btn-primary" onclick="showScheduleModal()">â° ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š</button>
                </div>
                
                <!-- ä¸€æ‹¬æ“ä½œ -->
                <div class="bulk-actions">
                    <button class="btn-sm btn-edit" onclick="bulkUpdateBudget()">é¸æŠã—ãŸé …ç›®ã®äºˆç®—ã‚’ä¸€æ‹¬å¤‰æ›´</button>
                    <button class="btn-sm btn-pause" onclick="bulkPause()">é¸æŠã—ãŸé …ç›®ã‚’ä¸€æ™‚åœæ­¢</button>
                    <button class="btn-sm btn-edit" onclick="bulkResume()">é¸æŠã—ãŸé …ç›®ã‚’å†é–‹</button>
                </div>
                
                <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
                <div id="messageArea"></div>
                
                <!-- ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ« -->
                <div id="campaignsTableContainer">
                    <div class="loading">ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ä¸€æ‹¬äºˆç®—æ›´æ–°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="bulkBudgetModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">ğŸ’° ä¸€æ‹¬äºˆç®—æ›´æ–°</h2>
            <p style="color: #6c757d; margin-bottom: 20px;">
                é¸æŠã—ãŸ<span id="selectedCount">0</span>ä»¶ã®ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã®äºˆç®—ã‚’æ›´æ–°ã—ã¾ã™
            </p>
            <div class="form-group">
                <label>æ–°ã—ã„æ—¥äºˆç®—ï¼ˆå††ï¼‰</label>
                <input type="number" id="bulkNewBudget" min="1" max="100000000" step="1" placeholder="ä¾‹: 10000">
                <small style="display: block; color: #6c757d; margin-top: 5px;">
                    â€» 1å††ä»¥ä¸Šã€1å„„å††ä»¥ä¸‹ã§è¨­å®šã—ã¦ãã ã•ã„
                </small>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn-primary" onclick="applyBulkBudget()">æ›´æ–°</button>
                <button class="btn-sm" onclick="closeBulkBudgetModal()" style="background: #6c757d; color: white;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>
    
    <!-- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">â° äºˆç®—ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š</h2>
            <div class="form-group">
                <label>ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³</label>
                <select id="scheduleCampaignId"></select>
            </div>
            <div class="form-group">
                <label>å®Ÿè¡Œæ—¥æ™‚</label>
                <input type="datetime-local" id="scheduleDateTime">
            </div>
            <div class="form-group">
                <label>æ–°ã—ã„äºˆç®—ï¼ˆå††ï¼‰</label>
                <input type="number" id="scheduleNewBudget" placeholder="ä¾‹: 10000">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn-primary" onclick="saveSchedule()">ä¿å­˜</button>
                <button class="btn-sm" onclick="closeModal()" style="background: #6c757d; color: white;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>
    
    <script>
        let campaigns = [];
        let selectedCampaigns = new Set();
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¸€è¦§ã‚’å–å¾—
        document.addEventListener('DOMContentLoaded', () => {
            loadCampaigns();
        });
        
        async function loadCampaigns() {
            try {
                const period = document.getElementById('periodFilter').value;
                const response = await fetch(`/api/campaigns/details?period=${period}`);
                const data = await response.json();
                
                if (data.success) {
                    campaigns = data.campaigns;
                    renderCampaignsTable(data.campaigns);
                } else {
                    showMessage('error', data.error || 'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showMessage('error', 'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }
        
        function renderCampaignsTable(campaigns) {
            const statusFilter = document.getElementById('statusFilter').value;
            const filteredCampaigns = statusFilter === 'all' 
                ? campaigns 
                : campaigns.filter(c => c.status === statusFilter);
            
            const html = `
                <table class="campaigns-table">
                    <thead>
                        <tr>
                            <th class="checkbox-column"><input type="checkbox" onchange="toggleSelectAll(this)"></th>
                            <th>ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³å</th>
                            <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                            <th>æ—¥äºˆç®—</th>
                            <th>æ¶ˆåŒ–é¡</th>
                            <th>ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³</th>
                            <th>CPA</th>
                            <th>CTR</th>
                            <th>CVæ•°</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredCampaigns.map(campaign => `
                            <tr>
                                <td><input type="checkbox" value="${campaign.id}" onchange="toggleSelect('${campaign.id}')"></td>
                                <td>${campaign.name}</td>
                                <td>
                                    <span class="status-badge ${campaign.status.toLowerCase()}">
                                        ${campaign.status === 'ACTIVE' ? 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–' : 'ä¸€æ™‚åœæ­¢'}
                                    </span>
                                </td>
                                <td class="budget-cell">
                                    <input type="number" class="budget-input" id="budget-${campaign.id}" 
                                           value="${Math.round((campaign.daily_budget || campaign.spend || 0) / 100)}"
                                           min="1" max="100000000" step="1"
                                           onkeypress="return event.charCode >= 48 && event.charCode <= 57" />
                                    <button class="btn-sm btn-edit" onclick="updateBudget('${campaign.id}')">æ›´æ–°</button>
                                </td>
                                <td>Â¥${campaign.spend?.toLocaleString() || 0}</td>
                                <td>${(campaign.impressions || 0).toLocaleString()}</td>
                                <td>Â¥${campaign.cpa?.toLocaleString() || '-'}</td>
                                <td>${campaign.ctr?.toFixed(2) || 0}%</td>
                                <td>${campaign.conversions || 0}</td>
                                <td class="action-buttons">
                                    ${campaign.status === 'ACTIVE' 
                                        ? `<button class="btn-sm btn-pause" onclick="toggleStatus('${campaign.id}', 'PAUSED')">åœæ­¢</button>`
                                        : `<button class="btn-sm btn-edit" onclick="toggleStatus('${campaign.id}', 'ACTIVE')">å†é–‹</button>`
                                    }
                                    <button class="btn-sm btn-delete" onclick="duplicateCampaign('${campaign.id}')">è¤‡è£½</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            document.getElementById('campaignsTableContainer').innerHTML = html;
        }
        
        function toggleSelectAll(checkbox) {
            const checkboxes = document.querySelectorAll('tbody input[type="checkbox"]');
            checkboxes.forEach(cb => {
                cb.checked = checkbox.checked;
                const campaignId = cb.value;
                if (checkbox.checked) {
                    selectedCampaigns.add(campaignId);
                } else {
                    selectedCampaigns.delete(campaignId);
                }
            });
        }
        
        function toggleSelect(campaignId) {
            if (selectedCampaigns.has(campaignId)) {
                selectedCampaigns.delete(campaignId);
            } else {
                selectedCampaigns.add(campaignId);
            }
        }
        
        async function updateBudget(campaignId) {
            const budgetInput = document.getElementById(`budget-${campaignId}`);
            if (!budgetInput) {
                showMessage('error', 'äºˆç®—å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            const newBudget = parseFloat(budgetInput.value);
            
            // è©³ç´°ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!newBudget || isNaN(newBudget)) {
                showMessage('error', 'äºˆç®—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (newBudget <= 0) {
                showMessage('error', 'äºˆç®—ã¯1å††ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„');
                budgetInput.value = '';
                budgetInput.focus();
                return;
            }
            
            if (newBudget > 100000000) {
                showMessage('error', 'äºˆç®—ã¯1å„„å††ä»¥ä¸‹ã§è¨­å®šã—ã¦ãã ã•ã„');
                budgetInput.focus();
                return;
            }
            
            // æ•´æ•°ãƒã‚§ãƒƒã‚¯
            if (newBudget !== Math.floor(newBudget)) {
                showMessage('error', 'äºˆç®—ã¯æ•´æ•°ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
                budgetInput.value = Math.floor(newBudget);
                return;
            }
            
            try {
                const response = await fetch('/api/campaigns/budget', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ campaign_id: campaignId, daily_budget: newBudget })
                });
                
                const data = await response.json();
                if (data.success) {
                    showMessage('success', 'äºˆç®—ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
                } else {
                    showMessage('error', data.error || 'äºˆç®—ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showMessage('error', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }
        
        async function toggleStatus(campaignId, newStatus) {
            try {
                const response = await fetch('/api/campaigns/status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ campaign_id: campaignId, status: newStatus })
                });
                
                const data = await response.json();
                if (data.success) {
                    showMessage('success', data.message);
                    loadCampaigns();
                } else {
                    showMessage('error', data.error || 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showMessage('error', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }
        
        async function duplicateCampaign(campaignId) {
            if (!confirm('ã“ã®ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’è¤‡è£½ã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            try {
                const response = await fetch('/api/campaigns/duplicate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ campaign_id: campaignId })
                });
                
                const data = await response.json();
                if (data.success) {
                    showMessage('success', 'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’è¤‡è£½ã—ã¾ã—ãŸ');
                    loadCampaigns();
                } else {
                    showMessage('error', data.error || 'è¤‡è£½ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showMessage('error', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }
        
        function bulkUpdateBudget() {
            if (selectedCampaigns.size === 0) {
                showMessage('error', 'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            document.getElementById('selectedCount').textContent = selectedCampaigns.size;
            document.getElementById('bulkBudgetModal').style.display = 'flex';
            document.getElementById('bulkNewBudget').value = '';
            document.getElementById('bulkNewBudget').focus();
        }
        
        function closeBulkBudgetModal() {
            document.getElementById('bulkBudgetModal').style.display = 'none';
        }
        
        async function applyBulkBudget() {
            const newBudgetInput = document.getElementById('bulkNewBudget');
            const newBudget = parseFloat(newBudgetInput.value);
            
            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!newBudget || isNaN(newBudget)) {
                showMessage('error', 'äºˆç®—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                newBudgetInput.focus();
                return;
            }
            
            if (newBudget <= 0) {
                showMessage('error', 'äºˆç®—ã¯1å††ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„');
                newBudgetInput.focus();
                return;
            }
            
            if (newBudget > 100000000) {
                showMessage('error', 'äºˆç®—ã¯1å„„å††ä»¥ä¸‹ã§è¨­å®šã—ã¦ãã ã•ã„');
                newBudgetInput.focus();
                return;
            }
            
            if (newBudget !== Math.floor(newBudget)) {
                showMessage('error', 'äºˆç®—ã¯æ•´æ•°ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
                newBudgetInput.value = Math.floor(newBudget);
                return;
            }
            
            closeBulkBudgetModal();
            showMessage('info', 'äºˆç®—ã‚’æ›´æ–°ä¸­...');
            
            let successCount = 0;
            for (const campaignId of selectedCampaigns) {
                try {
                    const response = await fetch('/api/campaigns/budget', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ campaign_id: campaignId, daily_budget: newBudget })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        successCount++;
                    }
                } catch (error) {
                    console.error('äºˆç®—æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                }
            }
            
            showMessage('success', `${successCount}ä»¶ã®ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³äºˆç®—ã‚’æ›´æ–°ã—ã¾ã—ãŸ`);
            selectedCampaigns.clear();
            loadCampaigns();
        }
        
        async function bulkPause() {
            if (selectedCampaigns.size === 0) {
                showMessage('error', 'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            for (const campaignId of selectedCampaigns) {
                await toggleStatus(campaignId, 'PAUSED');
            }
            
            showMessage('success', `${selectedCampaigns.size}ä»¶ã®ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã—ãŸ`);
            selectedCampaigns.clear();
            loadCampaigns();
        }
        
        async function bulkResume() {
            if (selectedCampaigns.size === 0) {
                showMessage('error', 'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            for (const campaignId of selectedCampaigns) {
                await toggleStatus(campaignId, 'ACTIVE');
            }
            
            showMessage('success', `${selectedCampaigns.size}ä»¶ã®ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’å†é–‹ã—ã¾ã—ãŸ`);
            selectedCampaigns.clear();
            loadCampaigns();
        }
        
        function showScheduleModal() {
            const modal = document.getElementById('scheduleModal');
            const select = document.getElementById('scheduleCampaignId');
            
            select.innerHTML = campaigns.map(c => 
                `<option value="${c.id}">${c.name}</option>`
            ).join('');
            
            modal.style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('scheduleModal').style.display = 'none';
        }
        
        async function saveSchedule() {
            const campaignId = document.getElementById('scheduleCampaignId').value;
            const dateTime = document.getElementById('scheduleDateTime').value;
            const newBudget = document.getElementById('scheduleNewBudget').value;
            
            try {
                const response = await fetch('/api/campaigns/schedule', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ campaign_id: campaignId, schedule_time: dateTime, new_budget: newBudget })
                });
                
                const data = await response.json();
                if (data.success) {
                    showMessage('success', 'ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¾ã—ãŸ');
                    closeModal();
                } else {
                    showMessage('error', data.error || 'ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showMessage('error', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }
        
        function showMessage(type, message) {
            const messageArea = document.getElementById('messageArea');
            messageArea.innerHTML = `<div class="${type}-message">${message}</div>`;
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 5000);
        }
    </script>
</body>
</html>