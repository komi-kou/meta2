<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metaåºƒå‘Šãƒ¬ãƒãƒ¼ãƒˆ</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f6fa;
        }
        
        /* çµ±ä¸€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆapp-containerä½¿ç”¨ï¼‰ */
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .content-header {
            margin-bottom: 30px;
        }
        
        .content-title {
            font-size: 28px;
            font-weight: 300;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        

        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border: none;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            color: white;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            pointer-events: none;
        }
        
        .metric-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            opacity: 0.8;
        }
        
        .metric-title {
            font-size: 14px;
            color: rgba(255,255,255,0.9);
            margin-bottom: 15px;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }
        
        .metric-unit {
            font-size: 16px;
            color: rgba(255,255,255,0.8);
            position: relative;
            z-index: 1;
        }
        
        .metric-card.spend {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .metric-card.budget {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .metric-card.ctr {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .metric-card.cpm {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        
        /* è¦–èªæ€§æ”¹å–„: CVã€CPAã€ãƒ•ãƒªãƒ¼ã‚¯ã‚¨ãƒ³ã‚·ãƒ¼ã‚«ãƒ¼ãƒ‰ã®è‰²å¤‰æ›´ */
        .metric-card.cv {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%) !important;
            color: white !important;
        }
        
        .metric-card.cpa {
            background: linear-gradient(135deg, #14532d 0%, #16a34a 100%) !important;
            color: white !important;
        }
        
        .metric-card.frequency {
            background: linear-gradient(135deg, #374151 0%, #6b7280 100%) !important;
            color: white !important;
        }
        
        .chart-section {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .chart-header {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-header::before {
            content: 'ğŸ“Š';
            font-size: 24px;
        }
        
        .chart-legend {
            display: flex;
            gap: 25px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #666;
            padding: 8px 15px;
            background: #f8f9fa;
            border-radius: 20px;
            transition: all 0.3s;
        }
        
        .legend-item:hover {
            background: #e9ecef;
            transform: scale(1.05);
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #888;
            font-size: 16px;
        }
        
        .loading::after {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #c33;
            display: none;
        }
        
        /* ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¸€è¦§ã¨ã‚¤ãƒ³ã‚µã‚¤ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .campaign-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .campaign-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .campaign-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .campaign-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .status-active {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-paused {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-deleted {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .campaign-objective {
            font-size: 12px;
            color: #6b7280;
        }
        
        .insight-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #6b7280;
            transition: all 0.3s ease;
        }
        
        .insight-item.warning {
            border-left-color: #f59e0b;
            background: #fef3c7;
        }
        
        .insight-item.success {
            border-left-color: #10b981;
            background: #d1fae5;
        }
        
        .insight-item.info {
            border-left-color: #3b82f6;
            background: #dbeafe;
        }
        
        .insight-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .insight-message {
            font-size: 14px;
            line-height: 1.5;
            color: #374151;
        }
        
        /* ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³é¸æŠã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .campaign-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .campaign-section label {
            font-weight: 500;
            color: #4a5568;
            white-space: nowrap;
        }
        
        .campaign-section select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            min-width: 150px;
            color: #374151;
        }
        
        .campaign-section select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆçµ±ä¸€ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>Metaåºƒå‘Šãƒ¬ãƒãƒ¼ãƒˆ</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="/dashboard" class="nav-item active">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
                <a href="/alerts" class="nav-item" id="alerts-link">ã‚¢ãƒ©ãƒ¼ãƒˆå†…å®¹</a>
                <a href="/alert-history" class="nav-item">ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´</a>
                <a href="/improvement-tasks" class="nav-item">ç¢ºèªäº‹é …</a>
                <a href="/improvement-strategies" class="nav-item">æ”¹å–„æ–½ç­–</a>
                <a href="/chatwork-test" class="nav-item">ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆ</a>
            </nav>
        </div>
        
        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="main-content">
            <!-- æ—¢å­˜ã®ã€Œç¾çŠ¶ã®æ•°å€¤ã€ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†ï¼ˆå…ƒã®ã¾ã¾ï¼‰ -->
            <div class="dashboard-header">
                <h1>ç¾çŠ¶ã®æ•°å€¤</h1>
            </div>
            
            <!-- 30åˆ†å‰ã®çŠ¶æ…‹ã«å¾©å…ƒ - ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«éƒ¨åˆ† -->
            <div class="header-controls">
                <div class="display-mode-section">
                    <label>è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰:</label>
                    <select id="dateMode">
                        <option value="1æ—¥ãšã¤" selected>1æ—¥ãšã¤</option>
                        <option value="æœŸé–“">æœŸé–“</option>
                    </select>
                </div>
                
                <!-- æœŸé–“é¸æŠã¯è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ãŒ'æœŸé–“'ã®æ™‚ã®ã¿è¡¨ç¤º -->
                <div id="periodSelector" class="period-section">
                    <label>æœŸé–“:</label>
                    <select id="periodRange">
                        <option value="7">éå»7æ—¥é–“</option>
                        <option value="14">éå»14æ—¥é–“</option>
                        <option value="30">éå»30æ—¥é–“</option>
                        <option value="all">å…¨æœŸé–“</option>
                    </select>
                </div>
                
                <div class="date-section">
                    <label>æ—¥ä»˜:</label>
                    <input type="date" id="selectedDate">
                </div>
                
                <div class="campaign-section">
                    <label>ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³:</label>
                    <select id="selectedCampaign">
                        <option value="">å…¨ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³</option>
                        <option value="loading">èª­ã¿è¾¼ã¿ä¸­...</option>
                    </select>
                </div>
                
                <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ -->
                <div class="export-buttons" style="display: flex; gap: 10px;">
                    <button id="exportSpreadsheet" class="export-btn" style="padding: 8px 16px; background: #34a853; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        ğŸ“Š ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    </button>
                </div>
            </div>
            
                <!-- æ—¢å­˜ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰ï¼ˆæ•°å€¤éƒ¨åˆ†ã¯ä¸€åˆ‡å¤‰æ›´ãªã—ï¼‰ -->
                <div class="metrics-grid">
                    <div class="metric-card spend">
                        <div class="metric-icon">ğŸ’°</div>
                        <div class="metric-title">æ¶ˆåŒ–é‡‘é¡ï¼ˆåˆè¨ˆï¼‰</div>
                        <div class="metric-value">
                            <span data-metric="spend">èª­ã¿è¾¼ã¿ä¸­...</span><span class="metric-unit">å††</span>
                        </div>
                    </div>
                    
                    <div class="metric-card budget">
                        <div class="metric-icon">ğŸ“Š</div>
                        <div class="metric-title">äºˆç®—æ¶ˆåŒ–ç‡ï¼ˆå¹³å‡ï¼‰</div>
                        <div class="metric-value">
                            <span data-metric="budget-rate">èª­ã¿è¾¼ã¿ä¸­...</span><span class="metric-unit">%</span>
                        </div>
                    </div>
                    
                    <div class="metric-card ctr">
                        <div class="metric-icon">ğŸ‘†</div>
                        <div class="metric-title">CTRï¼ˆå¹³å‡ï¼‰</div>
                        <div class="metric-value">
                            <span data-metric="ctr">èª­ã¿è¾¼ã¿ä¸­...</span><span class="metric-unit">%</span>
                        </div>
                    </div>
                    
                    <div class="metric-card cpm">
                        <div class="metric-icon">ğŸ“ˆ</div>
                        <div class="metric-title">CPMï¼ˆå¹³å‡ï¼‰</div>
                        <div class="metric-value">
                            <span data-metric="cpm">èª­ã¿è¾¼ã¿ä¸­...</span><span class="metric-unit">å††</span>
                        </div>
                    </div>
                </div>
                
                <!-- ä¸‹æ®µæŒ‡æ¨™ -->
                <div class="metrics-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 40px;">
                    <div class="metric-card cv">
                        <div class="metric-icon">ğŸ¯</div>
                        <div class="metric-title">CVï¼ˆåˆè¨ˆï¼‰</div>
                        <div class="metric-value">
                            <span data-metric="conversions">èª­ã¿è¾¼ã¿ä¸­...</span>
                        </div>
                    </div>
                    
                    <div class="metric-card cpa">
                        <div class="metric-icon">ğŸ’¸</div>
                        <div class="metric-title">CPAï¼ˆå¹³å‡ï¼‰</div>
                        <div class="metric-value">
                            <span data-metric="cpa">èª­ã¿è¾¼ã¿ä¸­...</span><span class="metric-unit">å††</span>
                        </div>
                    </div>
                    
                    <div class="metric-card frequency">
                        <div class="metric-icon">ğŸ”„</div>
                        <div class="metric-title">ãƒ•ãƒªãƒ¼ã‚¯ã‚¨ãƒ³ã‚·ãƒ¼ï¼ˆå¹³å‡ï¼‰</div>
                        <div class="metric-value">
                            <span data-metric="frequency">èª­ã¿è¾¼ã¿ä¸­...</span><span class="metric-unit">%</span>
                        </div>
                    </div>
                </div>

            <!-- æ—¢å­˜ã®ã‚°ãƒ©ãƒ•éƒ¨åˆ†ï¼ˆå®Œå…¨ã«å…ƒã®ã¾ã¾ï¼‰ -->
            <div class="chart-section">
                <h2>ğŸ“Š ä¸»è¦æŒ‡æ¨™ã®æ¨ç§»</h2>
                
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #8b5cf6;"></div>
                        <span>æ¶ˆåŒ–é‡‘é¡</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3b82f6;"></div>
                        <span>CTR(%)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #10b981;"></div>
                        <span>CPM</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f59e0b;"></div>
                        <span>CV</span>
                    </div>
                    <!-- âœ… CPAè¿½åŠ  -->
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ef4444;"></div>
                        <span>CPA</span>
                    </div>
                    <!-- âœ… ãƒ•ãƒªãƒ¼ã‚¯ã‚¨ãƒ³ã‚·ãƒ¼è¿½åŠ  -->
                    <div class="legend-item">
                        <div class="legend-color" style="background: #6b7280;"></div>
                        <span>ãƒ•ãƒªãƒ¼ã‚¯ã‚¨ãƒ³ã‚·ãƒ¼</span>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
            
            <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º -->
            <div class="error-message" style="display: none;"></div>
            
            <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
            <div class="loading-message" style="display: none; text-align: center; padding: 20px; color: #666;">
                <div>ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
            </div>
            
            <!-- ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³åˆ¥è©³ç´°æ•°å€¤ -->
            <div class="chart-section" style="margin-top: 30px;">
                <h2>ğŸ“Š ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h2>
                <div id="campaign-details" style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f3f4f6; border-bottom: 2px solid #e5e7eb;">
                                <th style="padding: 12px; text-align: left;">ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³å</th>
                                <th style="padding: 12px; text-align: center;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                <th style="padding: 12px; text-align: right;">åºƒå‘Šè²»</th>
                                <th style="padding: 12px; text-align: right;">CTR</th>
                                <th style="padding: 12px; text-align: right;">CPM</th>
                                <th style="padding: 12px; text-align: right;">CV</th>
                                <th style="padding: 12px; text-align: right;">CPA</th>
                                <th style="padding: 12px; text-align: center;">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
                            </tr>
                        </thead>
                        <tbody id="campaign-details-body">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 20px; color: #666;">
                                    ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="chart-section" style="margin-top: 30px;">
                <h2>âš ï¸ ã‚¢ãƒ©ãƒ¼ãƒˆ</h2>
                
                <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e5e7eb;">
                    <button onclick="showAlertTab('current')" id="tab-current" style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 4px 4px 0 0; cursor: pointer;">
                        ç¾åœ¨ã®ã‚¢ãƒ©ãƒ¼ãƒˆ
                    </button>
                    <button onclick="showAlertTab('history')" id="tab-history" style="padding: 10px 20px; background: #e5e7eb; color: #374151; border: none; border-radius: 4px 4px 0 0; cursor: pointer;">
                        ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´
                    </button>
                    <button onclick="showAlertTab('checklist')" id="tab-checklist" style="padding: 10px 20px; background: #e5e7eb; color: #374151; border: none; border-radius: 4px 4px 0 0; cursor: pointer;">
                        ç¢ºèªäº‹é …
                    </button>
                    <button onclick="showAlertTab('improvements')" id="tab-improvements" style="padding: 10px 20px; background: #e5e7eb; color: #374151; border: none; border-radius: 4px 4px 0 0; cursor: pointer;">
                        æ”¹å–„æ–½ç­–
                    </button>
                </div>
                
                <!-- ç¾åœ¨ã®ã‚¢ãƒ©ãƒ¼ãƒˆ -->
                <div id="alert-current" class="alert-tab-content" style="padding: 20px;">
                    <div id="alert-messages" style="display: flex; flex-direction: column; gap: 10px;">
                        <!-- ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                        <div style="padding: 12px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 4px;">
                            <div style="font-weight: 500; color: #f59e0b;">âš ï¸ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</div>
                            <div style="color: #374151; margin-top: 4px;">ã‚¢ãƒ©ãƒ¼ãƒˆæƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™</div>
                        </div>
                    </div>
                </div>
                
                <!-- ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ -->
                <div id="alert-history" class="alert-tab-content" style="padding: 20px; display: none;">
                    <div id="alert-history-content">
                        <!-- ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                        <h3 style="margin-bottom: 15px;">ğŸ“… éå»7æ—¥é–“ã®ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´</h3>
                        <div style="color: #6b7280;">å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
                    </div>
                </div>
                
                <!-- ç¢ºèªäº‹é … -->
                <div id="alert-checklist" class="alert-tab-content" style="padding: 20px; display: none;">
                    <div id="checklist-content">
                        <h3 style="margin-bottom: 15px;">ğŸ“‹ ç¢ºèªã™ã¹ãé …ç›®</h3>
                        <ul style="list-style: none; padding: 0;">
                            <li style="padding: 10px; background: #f3f4f6; margin-bottom: 8px; border-radius: 4px;">
                                âœ… ã‚¿ãƒ¼ã‚²ãƒ†ã‚£ãƒ³ã‚°è¨­å®šã®è¦‹ç›´ã—ï¼ˆå¹´é½¢å±¤ã€åœ°åŸŸã€èˆˆå‘³é–¢å¿ƒï¼‰
                            </li>
                            <li style="padding: 10px; background: #f3f4f6; margin-bottom: 8px; border-radius: 4px;">
                                âœ… ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã®ç–²åŠ´åº¦ãƒã‚§ãƒƒã‚¯ï¼ˆåŒã˜åºƒå‘Šã®è¡¨ç¤ºå›æ•°ï¼‰
                            </li>
                            <li style="padding: 10px; background: #f3f4f6; margin-bottom: 8px; border-radius: 4px;">
                                âœ… ç«¶åˆä»–ç¤¾ã®åºƒå‘Šå‹•å‘ã®ç¢ºèª
                            </li>
                            <li style="padding: 10px; background: #f3f4f6; margin-bottom: 8px; border-radius: 4px;">
                                âœ… ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿é€Ÿåº¦ã¨ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£
                            </li>
                            <li style="padding: 10px; background: #f3f4f6; margin-bottom: 8px; border-radius: 4px;">
                                âœ… ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã®æ­£å¸¸å‹•ä½œç¢ºèª
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- æ”¹å–„æ–½ç­– -->
                <div id="alert-improvements" class="alert-tab-content" style="padding: 20px; display: none;">
                    <div id="improvements-content">
                        <!-- æ”¹å–„æ–½ç­–ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                        <h3 style="margin-bottom: 15px;">ğŸ’¡ æ¨å¥¨æ”¹å–„æ–½ç­–</h3>
                        <div style="color: #6b7280;">æ”¹å–„æ–½ç­–ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
                    </div>
                </div>
            </div>
            
            <!-- æœ€çµ‚æ›´æ–°æ™‚é–“è¡¨ç¤º -->
            <div style="text-align: center; margin-top: 30px; color: #666; font-size: 14px;">
                æœ€çµ‚æ›´æ–°: <span id="last-update">-</span>
            </div>
        </div>
        </div>
    </div>

    <script>
        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®è¨­å®šç¢ºèªã¨è‡ªå‹•ãƒ‡ãƒ¼ã‚¿å–å¾—
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('=== ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ– ===');
            
            try {
                // è¨­å®šçŠ¶æ³ç¢ºèª
                const debugResponse = await fetch('/api/debug-meta-config');
                const debugData = await debugResponse.json();
                console.log('è¨­å®šãƒ‡ãƒãƒƒã‚°æƒ…å ±:', debugData);
                
                if (debugData.finalResult.configFound) {
                    console.log('âœ… Meta APIè¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ');
                    
                    // ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿
                    await loadCampaigns();
                    hideErrorMessage();
                    
                    // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
                    const today = new Date().toISOString().split('T')[0];
                    const dateInput = document.getElementById('selectedDate');
                    if (dateInput) {
                        dateInput.value = today;
                    }
                    
                    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
                    setupEventListeners();
                    
                    // åˆæœŸè¡¨ç¤ºçŠ¶æ…‹è¨­å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’1æ—¥ã«å¤‰æ›´ï¼‰
                    const dateMode = document.getElementById('dateMode');
                    if (dateMode) {
                        dateMode.value = '1æ—¥ãšã¤'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’1æ—¥ã«è¨­å®š
                        document.getElementById('periodSelector').style.display = 'none';
                    }
                    
                    // åˆæœŸãƒ‡ãƒ¼ã‚¿å–å¾—
                    setTimeout(() => {
                        updateDashboardData();
                        loadCampaignDetails();  // ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³è©³ç´°ã‚’èª­ã¿è¾¼ã¿
                        loadAlerts();  // ã‚¢ãƒ©ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿
                    }, 100);
                } else {
                    console.log('âŒ Meta APIè¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    showErrorMessage('Meta APIè¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚è¨­å®šç”»é¢ã§å†åº¦è¨­å®šã—ã¦ãã ã•ã„ã€‚');
                }
                
            } catch (error) {
                console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                showErrorMessage('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        });

        // çŠ¶æ…‹ç®¡ç†ã‚’30åˆ†å‰ã®çŠ¶æ…‹ã«æˆ»ã™
        let displayMode = 'daily'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯1æ—¥ãšã¤
        let period = '1'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’1æ—¥ã«å¤‰æ›´
        let selectedDate = new Date().toISOString().split('T')[0]; // æœ€æ–°æ—¥ï¼ˆå½“æ—¥ï¼‰ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«
        let currentExportPeriod = 'last_7d'; // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç”¨ã®æœŸé–“ã‚’è¿½åŠ 

        function setupEventListeners() {
            const dateMode = document.getElementById('dateMode');
            const selectedDateInput = document.getElementById('selectedDate');
            const periodRange = document.getElementById('periodRange');
            
            // åˆæœŸè¨­å®š
            const today = new Date().toISOString().split('T')[0];
            if (selectedDateInput) {
                selectedDateInput.value = today;
            }
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã‚’1æ—¥ã«è¨­å®š
            if (dateMode) {
                dateMode.value = '1æ—¥ãšã¤';
                // 1æ—¥ãšã¤é¸æŠæ™‚ï¼šæœŸé–“é¸æŠã‚’éè¡¨ç¤º
                document.getElementById('periodSelector').style.display = 'none';
            }
            
            if (dateMode) {
                dateMode.addEventListener('change', function() {
                    const mode = this.value;
                    console.log('è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰å¤‰æ›´:', mode);
                    
                    // è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ¡ä»¶åˆ†å²ï¼ˆ30åˆ†å‰ã®çŠ¶æ…‹ï¼‰
                    if (mode === '1æ—¥ãšã¤') {
                        // 1æ—¥ãšã¤é¸æŠæ™‚ï¼šæœŸé–“é¸æŠã‚’éè¡¨ç¤º
                        document.getElementById('periodSelector').style.display = 'none';
                    } else {
                        // æœŸé–“é¸æŠæ™‚ï¼šæœŸé–“é¸æŠã‚’è¡¨ç¤º
                        document.getElementById('periodSelector').style.display = 'flex';
                    }
                    
                    // å³åº§ã«ãƒ‡ãƒ¼ã‚¿æ›´æ–°
                    updateDashboardData();
                });
            }
            
            if (selectedDateInput) {
                selectedDateInput.addEventListener('change', function() {
                    const date = this.value;
                    console.log('é¸æŠæ—¥ä»˜å¤‰æ›´:', date);
                    
                    if (date) {
                        updateDashboardData();
                    }
                });
            }
            
            if (periodRange) {
                periodRange.addEventListener('change', function() {
                    const periodValue = this.value;
                    const periodLabel = periodValue === 'all' ? 'å…¨æœŸé–“' : periodValue + 'æ—¥é–“';
                    console.log('é¸æŠæœŸé–“å¤‰æ›´:', periodLabel);
                    
                    // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç”¨ã®æœŸé–“å½¢å¼ã«å¤‰æ›
                    const periodMap = {
                        '1': 'today',
                        '3': 'last_3d',
                        '7': 'last_7d',
                        '14': 'last_14d',
                        '30': 'last_30d',
                        'all': 'lifetime'
                    };
                    currentExportPeriod = periodMap[periodValue] || 'last_7d';
                    period = periodValue; // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚‚æ›´æ–°
                    console.log('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæœŸé–“æ›´æ–°:', currentExportPeriod);
                    
                    updateDashboardData();
                });
            }
            
            // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            const exportSpreadsheetBtn = document.getElementById('exportSpreadsheet');
            if (exportSpreadsheetBtn) {
                exportSpreadsheetBtn.addEventListener('click', function() {
                    const campaignSelect = document.getElementById('campaign-select');
                    const campaignId = campaignSelect ? campaignSelect.value : 'all';
                    
                    // è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦é©åˆ‡ãªæœŸé–“ã‚’ä½¿ç”¨
                    let exportPeriod;
                    const dateMode = document.getElementById('dateMode');
                    if (dateMode && dateMode.value === '1æ—¥ãšã¤') {
                        // 1æ—¥ãšã¤ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯é¸æŠã•ã‚ŒãŸæ—¥ä»˜ã‚’ä½¿ç”¨
                        const selectedDateValue = document.getElementById('selectedDate')?.value;
                        exportPeriod = selectedDateValue ? 'today' : 'last_7d';
                    } else {
                        // æœŸé–“ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯é¸æŠã•ã‚ŒãŸæœŸé–“ã‚’ä½¿ç”¨
                        exportPeriod = currentExportPeriod || 'last_7d';
                    }
                    
                    console.log('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Ÿè¡Œ:', { period: exportPeriod, campaign: campaignId });
                    window.location.href = `/api/export/spreadsheet?period=${exportPeriod}&campaign_id=${campaignId}`;
                });
            }
        }
        
        // ã‚¢ãƒ©ãƒ¼ãƒˆã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function showAlertTab(tabName) {
            // å…¨ã¦ã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
            document.querySelectorAll('.alert-tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // å…¨ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.style.background = '#e5e7eb';
                btn.style.color = '#374151';
            });
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’è¡¨ç¤º
            const selectedContent = document.getElementById(`alert-${tabName}`);
            if (selectedContent) {
                selectedContent.style.display = 'block';
            }
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ›´æ–°
            const selectedTab = document.getElementById(`tab-${tabName}`);
            if (selectedTab) {
                selectedTab.style.background = '#3b82f6';
                selectedTab.style.color = 'white';
            }
            
            // ã‚¿ãƒ–ã”ã¨ã®è¿½åŠ å‡¦ç†
            if (tabName === 'history') {
                loadAlertHistory();
            } else if (tabName === 'improvements') {
                loadImprovements();
            }
        }
        
        // ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³è¤‡è£½é–¢æ•°
        async function duplicateCampaign(campaignId, campaignName) {
            if (!confirm(`ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã€Œ${campaignName}ã€ã‚’è¤‡è£½ã—ã¾ã™ã‹ï¼Ÿ`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/campaigns/duplicate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ campaign_id: campaignId })
                });
                
                const result = await response.json();
                if (result.success) {
                    alert('ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’è¤‡è£½ã—ã¾ã—ãŸ');
                    loadCampaignDetails(); // ä¸€è¦§ã‚’æ›´æ–°
                } else {
                    alert('è¤‡è£½ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.error);
                }
            } catch (error) {
                console.error('è¤‡è£½ã‚¨ãƒ©ãƒ¼:', error);
                alert('è¤‡è£½ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }
        
        // ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        async function toggleCampaignStatus(campaignId, currentStatus) {
            const newStatus = currentStatus === 'ACTIVE' ? 'PAUSED' : 'ACTIVE';
            const action = newStatus === 'PAUSED' ? 'åœæ­¢' : 'å†é–‹';
            
            if (!confirm(`ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’${action}ã—ã¾ã™ã‹ï¼Ÿ`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/campaigns/status', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        campaign_id: campaignId,
                        status: newStatus 
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    alert(`ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’${action}ã—ã¾ã—ãŸ`);
                    loadCampaignDetails(); // ä¸€è¦§ã‚’æ›´æ–°
                } else {
                    alert(`${action}ã«å¤±æ•—ã—ã¾ã—ãŸ: ` + result.error);
                }
            } catch (error) {
                console.error('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ã‚¨ãƒ©ãƒ¼:', error);
                alert('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }
        
        // ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³åˆ¥è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
        async function loadCampaignDetails() {
            try {
                const response = await fetch('/api/campaigns/details?period=last_7d');
                const data = await response.json();
                
                if (data.success && data.campaigns) {
                    const tbody = document.getElementById('campaign-details-body');
                    if (tbody) {
                        tbody.innerHTML = data.campaigns.map(campaign => {
                            const statusColor = campaign.status === 'ACTIVE' ? '#10b981' : '#6b7280';
                            const statusText = campaign.status === 'ACTIVE' ? 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–' : 'ä¸€æ™‚åœæ­¢';
                            const pauseButtonText = campaign.status === 'ACTIVE' ? 'â¸ï¸ åœæ­¢' : 'â–¶ï¸ å†é–‹';
                            const pauseButtonColor = campaign.status === 'ACTIVE' ? '#ef4444' : '#10b981';
                            
                            return `
                                <tr style="border-bottom: 1px solid #e5e7eb;">
                                    <td style="padding: 12px;">${campaign.name}</td>
                                    <td style="padding: 12px; text-align: center;">
                                        <span style="color: ${statusColor}; font-weight: 500;">${statusText}</span>
                                    </td>
                                    <td style="padding: 12px; text-align: right;">${campaign.spend.toLocaleString()}å††</td>
                                    <td style="padding: 12px; text-align: right;">${campaign.ctr.toFixed(2)}%</td>
                                    <td style="padding: 12px; text-align: right;">${Math.round(campaign.cpm).toLocaleString()}å††</td>
                                    <td style="padding: 12px; text-align: right;">${campaign.conversions}</td>
                                    <td style="padding: 12px; text-align: right;">${campaign.conversions > 0 && campaign.cpa ? campaign.cpa.toLocaleString() + 'å††' : '-'}</td>
                                    <td style="padding: 12px; text-align: center;">
                                        <button onclick="duplicateCampaign('${campaign.id}', '${campaign.name.replace(/'/g, "\\'")}')" 
                                                style="padding: 4px 8px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 0 2px;">
                                            ğŸ“‹ è¤‡è£½
                                        </button>
                                        <button onclick="toggleCampaignStatus('${campaign.id}', '${campaign.status}')" 
                                                style="padding: 4px 8px; background: ${pauseButtonColor}; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 0 2px;">
                                            ${pauseButtonText}
                                        </button>
                                    </td>
                                </tr>
                            `;
                        }).join('');
                    }
                }
            } catch (error) {
                console.error('ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³è©³ç´°èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // ã‚¢ãƒ©ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
        async function loadAlerts() {
            console.log('ğŸ“Œ loadAlertsé–¢æ•°ãŒå‘¼ã°ã‚Œã¾ã—ãŸ');
            try {
                const response = await fetch('/api/alerts');
                console.log('ğŸ“Œ ã‚¢ãƒ©ãƒ¼ãƒˆAPIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:', response.status);
                
                if (!response.ok) {
                    throw new Error(`APIã‚¨ãƒ©ãƒ¼: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('ğŸ“Œ ã‚¢ãƒ©ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿:', data);
                
                const alertArea = document.getElementById('alert-messages');
                if (alertArea) {
                    if (data.success && data.alerts && data.alerts.length > 0) {
                        alertArea.innerHTML = data.alerts.map(alert => {
                            const alertColor = alert.severity === 'critical' ? '#ef4444' : '#f59e0b';
                            return `
                                <div style="padding: 12px; background: ${alertColor}20; border-left: 4px solid ${alertColor}; border-radius: 4px;">
                                    <div style="font-weight: 500; color: ${alertColor};">âš ï¸ ${alert.metric}</div>
                                    <div style="color: #374151; margin-top: 4px;">${alert.message}</div>
                                </div>
                            `;
                        }).join('');
                    } else {
                        alertArea.innerHTML = '<div style="color: #10b981;">âœ… ç¾åœ¨ã€ã‚¢ãƒ©ãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                    }
                } else {
                    console.error('ğŸ“Œ alert-messagesã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
            } catch (error) {
                console.error('ğŸ“Œ ã‚¢ãƒ©ãƒ¼ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                const alertArea = document.getElementById('alert-messages');
                if (alertArea) {
                    alertArea.innerHTML = `<div style="color: #ef4444;">âš ï¸ ã‚¢ãƒ©ãƒ¼ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}</div>`;
                }
            }
        }
        
        // ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
        async function loadAlertHistory() {
            console.log('ğŸ“Œ loadAlertHistoryé–¢æ•°ãŒå‘¼ã°ã‚Œã¾ã—ãŸ');
            try {
                const response = await fetch('/api/alerts-history');
                console.log('ğŸ“Œ ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:', response.status);
                
                if (!response.ok) {
                    throw new Error(`APIã‚¨ãƒ©ãƒ¼: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('ğŸ“Œ ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ãƒ‡ãƒ¼ã‚¿:', data);
                
                const historyContent = document.getElementById('alert-history-content');
                if (historyContent) {
                    if (data.history && data.history.length > 0) {
                        historyContent.innerHTML = `
                            <h3 style="margin-bottom: 15px;">ğŸ“… éå»7æ—¥é–“ã®ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´</h3>
                            ${data.history.map(item => {
                                const date = new Date(item.date).toLocaleDateString('ja-JP');
                                const statusColor = item.resolved ? '#10b981' : '#ef4444';
                                const statusText = item.resolved ? 'è§£æ±ºæ¸ˆã¿' : 'æœªè§£æ±º';
                                return `
                                    <div style="padding: 12px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 4px; margin-bottom: 10px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <div style="font-weight: 500;">${date} - ${item.metric}</div>
                                                <div style="color: #6b7280; margin-top: 4px;">${item.message}</div>
                                            </div>
                                            <span style="color: ${statusColor}; font-weight: 500;">${statusText}</span>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        `;
                    } else {
                        historyContent.innerHTML = '<div style="color: #6b7280;">éå»7æ—¥é–“ã®ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                    }
                }
            } catch (error) {
                console.error('ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // æ”¹å–„æ–½ç­–ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
        async function loadImprovements() {
            console.log('ğŸ“Œ loadImprovementsé–¢æ•°ãŒå‘¼ã°ã‚Œã¾ã—ãŸ');
            try {
                const response = await fetch('/api/improvements');
                console.log('ğŸ“Œ æ”¹å–„æ–½ç­–APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:', response.status);
                
                if (!response.ok) {
                    throw new Error(`APIã‚¨ãƒ©ãƒ¼: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('ğŸ“Œ æ”¹å–„æ–½ç­–ãƒ‡ãƒ¼ã‚¿:', data);
                
                const improvementsContent = document.getElementById('improvements-content');
                if (improvementsContent) {
                    improvementsContent.innerHTML = `
                        <h3 style="margin-bottom: 15px;">ğŸ’¡ æ¨å¥¨æ”¹å–„æ–½ç­–</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #ef4444; margin-bottom: 10px;">ğŸ”´ CPAãŒé«˜ã„å ´åˆã®æ”¹å–„ç­–</h4>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 10px; background: #fef2f2; margin-bottom: 8px; border-radius: 4px; border-left: 3px solid #ef4444;">
                                    ğŸ“Š ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ã®çµã‚Šè¾¼ã¿ï¼ˆã‚ˆã‚Šè³¼è²·æ„æ¬²ã®é«˜ã„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«é›†ä¸­ï¼‰
                                </li>
                                <li style="padding: 10px; background: #fef2f2; margin-bottom: 8px; border-radius: 4px; border-left: 3px solid #ef4444;">
                                    ğŸ¨ åºƒå‘Šã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã®A/Bãƒ†ã‚¹ãƒˆå®Ÿæ–½
                                </li>
                                <li style="padding: 10px; background: #fef2f2; margin-bottom: 8px; border-radius: 4px; border-left: 3px solid #ef4444;">
                                    ğŸ¯ ãƒªã‚¿ãƒ¼ã‚²ãƒ†ã‚£ãƒ³ã‚°è¨­å®šã®è¦‹ç›´ã—
                                </li>
                            </ul>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #f59e0b; margin-bottom: 10px;">ğŸŸ¡ CTRãŒä½ã„å ´åˆã®æ”¹å–„ç­–</h4>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 10px; background: #fef3c7; margin-bottom: 8px; border-radius: 4px; border-left: 3px solid #f59e0b;">
                                    âœï¸ åºƒå‘Šã‚³ãƒ”ãƒ¼ã®è¦‹ç›´ã—ï¼ˆã‚ˆã‚Šé­…åŠ›çš„ãªè¨´æ±‚æ–‡ã«å¤‰æ›´ï¼‰
                                </li>
                                <li style="padding: 10px; background: #fef3c7; margin-bottom: 8px; border-radius: 4px; border-left: 3px solid #f59e0b;">
                                    ğŸ–¼ï¸ ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«è¦ç´ ã®æ”¹å–„ï¼ˆå‹•ç”»ã‚„ã‚«ãƒ«ãƒ¼ã‚»ãƒ«åºƒå‘Šã®æ´»ç”¨ï¼‰
                                </li>
                                <li style="padding: 10px; background: #fef3c7; margin-bottom: 8px; border-radius: 4px; border-left: 3px solid #f59e0b;">
                                    ğŸ“± ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ¡ãƒ³ãƒˆã®æœ€é©åŒ–ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è‰¯ã„é…ç½®ã«é›†ä¸­ï¼‰
                                </li>
                            </ul>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #10b981; margin-bottom: 10px;">ğŸŸ¢ äºˆç®—æ¶ˆåŒ–ç‡ãŒä½ã„å ´åˆã®æ”¹å–„ç­–</h4>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 10px; background: #d1fae5; margin-bottom: 8px; border-radius: 4px; border-left: 3px solid #10b981;">
                                    ğŸ¯ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ã®æ‹¡å¤§ï¼ˆé¡ä¼¼ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ã®æ´»ç”¨ï¼‰
                                </li>
                                <li style="padding: 10px; background: #d1fae5; margin-bottom: 8px; border-radius: 4px; border-left: 3px solid #10b981;">
                                    ğŸ’° å…¥æœ­ä¾¡æ ¼ã®èª¿æ•´ï¼ˆç«¶äº‰åŠ›ã®ã‚ã‚‹å…¥æœ­ã¸ï¼‰
                                </li>
                                <li style="padding: 10px; background: #d1fae5; margin-bottom: 8px; border-radius: 4px; border-left: 3px solid #10b981;">
                                    ğŸ“ˆ é…ä¿¡æ™‚é–“å¸¯ã®æ‹¡å¤§ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è‰¯ã„æ™‚é–“å¸¯ã‚’è¦‹ã¤ã‘ã‚‹ï¼‰
                                </li>
                            </ul>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('æ”¹å–„æ–½ç­–èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                const improvementsContent = document.getElementById('improvements-content');
                if (improvementsContent) {
                    improvementsContent.innerHTML = '<div style="color: #ef4444;">æ”¹å–„æ–½ç­–ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
                }
            }
        }

        // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºæ”¹å–„
        async function updateDashboardData() {
            console.log('=== å®Ÿéš›ã®Metaåºƒå‘Šãƒ‡ãƒ¼ã‚¿æ›´æ–° ===');
            
            const mode = document.getElementById('dateMode').value;
            const params = new URLSearchParams();
            
            showLoadingState();
            hideErrorMessage();
            
            if (mode === '1æ—¥ãšã¤') {
                const selectedDate = document.getElementById('selectedDate').value;
                if (!selectedDate) {
                    hideLoadingState();
                    showErrorMessage('æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }
                params.append('type', 'daily');
                params.append('date', selectedDate);
            } else {
                const period = document.getElementById('periodRange').value;
                params.append('type', 'period');
                params.append('period', period);
            }
            
            const selectedCampaign = document.getElementById('selectedCampaign').value;
            if (selectedCampaign) {
                params.append('campaignId', selectedCampaign);
            }
            
            try {
                const response = await fetch(`/api/meta-ads-data?${params}`);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    
                    // èªè¨¼ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                    if (response.status === 401 && errorData.needLogin) {
                        console.log('èªè¨¼ã‚¨ãƒ©ãƒ¼: ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ');
                        window.location.href = '/login';
                        return;
                    }
                    
                    throw new Error(errorData.details || errorData.message || 'ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
                const data = await response.json();
                console.log('å®Ÿéš›ã®Metaåºƒå‘Šãƒ‡ãƒ¼ã‚¿å—ä¿¡:', data);
                
                updateMetricsDisplay(data);
                updateChart(data);
                
                hideLoadingState();
                
            } catch (error) {
                console.error('Metaåºƒå‘Šãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                hideLoadingState();
                showErrorMessage(`Metaåºƒå‘Šãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateDummyData() {
            return {
                spend: Math.floor(Math.random() * 50000) + 10000,
                budgetRate: (Math.random() * 50 + 50).toFixed(2),
                ctr: (Math.random() * 5 + 1).toFixed(2),
                cpm: Math.floor(Math.random() * 3000) + 2000,
                conversions: Math.floor(Math.random() * 50) + 10,
                cpa: Math.floor(Math.random() * 2000) + 300,
                frequency: (Math.random() * 3 + 0.5).toFixed(2),
                chartData: {
                    labels: ['7/6', '7/7', '7/8', '7/9', '7/10', '7/11', '7/12'],
                    spend: Array.from({length: 7}, () => Math.floor(Math.random() * 20000) + 5000),
                    ctr: Array.from({length: 7}, () => (Math.random() * 5 + 1).toFixed(2)),
                    cpm: Array.from({length: 7}, () => Math.floor(Math.random() * 3000) + 2000),
                    conversions: Array.from({length: 7}, () => Math.floor(Math.random() * 30) + 5),
                    cpa: Array.from({length: 7}, () => Math.floor(Math.random() * 2000) + 300),           // âœ… CPAè¿½åŠ 
                    frequency: Array.from({length: 7}, () => (Math.random() * 3 + 0.5).toFixed(2))        // âœ… ãƒ•ãƒªãƒ¼ã‚¯ã‚¨ãƒ³ã‚·ãƒ¼è¿½åŠ 
                }
            };
        }

        // ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¡¨ç¤ºæ›´æ–°ï¼ˆç¢ºå®Ÿãªãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼‰
        function updateMetricsDisplay(data) {
            console.log('=== ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°é–‹å§‹ ===');
            
            const updates = [
                { selector: '[data-metric="spend"]', value: `${data.spend.toLocaleString()}` },
                { selector: '[data-metric="budget-rate"]', value: data.budgetRate !== undefined && data.budgetRate !== null ? `${parseFloat(data.budgetRate).toFixed(1)}` : '0.0' },
                { selector: '[data-metric="ctr"]', value: `${parseFloat(data.ctr).toFixed(2)}` },
                { selector: '[data-metric="cpm"]', value: `${data.cpm.toLocaleString()}` },
                { selector: '[data-metric="conversions"]', value: data.conversions || 0 },
                { selector: '[data-metric="cpa"]', value: data.cpa !== undefined && data.cpa !== null ? `${Math.round(data.cpa).toLocaleString()}` : '-' },
                { selector: '[data-metric="frequency"]', value: `${parseFloat(data.frequency).toFixed(2)}` }
            ];
            
            updates.forEach(update => {
                const element = document.querySelector(update.selector);
                if (element) {
                    element.textContent = update.value;
                    console.log(`æ›´æ–°å®Œäº†: ${update.selector} = ${update.value}`);
                } else {
                    console.error(`è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${update.selector}`);
                }
            });
        }

        // ã‚°ãƒ©ãƒ•æ›´æ–°æ©Ÿèƒ½ï¼ˆChart.jsç¢ºå®Ÿå‹•ä½œï¼‰
        function updateChart(data) {
            console.log('=== ã‚°ãƒ©ãƒ•æ›´æ–°ï¼ˆCPAãƒ»ãƒ•ãƒªãƒ¼ã‚¯ã‚¨ãƒ³ã‚·ãƒ¼è¿½åŠ ç‰ˆï¼‰ ===', data.chartData);
            
            const canvas = document.getElementById('performanceChart');
            if (!canvas) {
                console.error('Canvasè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            // æ—¢å­˜ãƒãƒ£ãƒ¼ãƒˆç ´æ£„
            if (window.chartInstance) {
                window.chartInstance.destroy();
                window.chartInstance = null;
            }
            
            try {
                const ctx = canvas.getContext('2d');
                
                window.chartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.chartData.labels,
                        datasets: [
                            {
                                label: 'æ¶ˆåŒ–é‡‘é¡',
                                data: data.chartData.spend,
                                borderColor: '#8b5cf6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                tension: 0.4,
                                fill: true,
                                yAxisID: 'y'
                            },
                            {
                                label: 'CTR(%)',
                                data: data.chartData.ctr,
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.4,
                                fill: true,
                                yAxisID: 'y1'
                            },
                            {
                                label: 'CPM',
                                data: data.chartData.cpm,
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.4,
                                fill: true,
                                yAxisID: 'y'
                            },
                            {
                                label: 'CV',
                                data: data.chartData.conversions,
                                borderColor: '#f59e0b',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                tension: 0.4,
                                fill: true,
                                yAxisID: 'y2'
                            },
                            // âœ… CPAè¿½åŠ 
                            {
                                label: 'CPA',
                                data: data.chartData.cpa || [],
                                borderColor: '#ef4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                tension: 0.4,
                                fill: true,
                                yAxisID: 'y'
                            },
                            // âœ… ãƒ•ãƒªãƒ¼ã‚¯ã‚¨ãƒ³ã‚·ãƒ¼è¿½åŠ 
                            {
                                label: 'ãƒ•ãƒªãƒ¼ã‚¯ã‚¨ãƒ³ã‚·ãƒ¼',
                                data: data.chartData.frequency || [],
                                borderColor: '#6b7280',
                                backgroundColor: 'rgba(107, 114, 128, 0.1)',
                                tension: 0.4,
                                fill: true,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'é‡‘é¡'
                                },
                                beginAtZero: true
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'ç‡ãƒ»å›æ•°'
                                },
                                grid: {
                                    drawOnChartArea: false,
                                },
                                beginAtZero: true
                            },
                            y2: {
                                type: 'linear',
                                display: false,
                                beginAtZero: true
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top'
                            }
                        }
                    }
                });
                
                console.log('âœ… ã‚°ãƒ©ãƒ•ä½œæˆå®Œäº†ï¼ˆCPAãƒ»ãƒ•ãƒªãƒ¼ã‚¯ã‚¨ãƒ³ã‚·ãƒ¼å«ã‚€ï¼‰');
                
            } catch (error) {
                console.error('âŒ ã‚°ãƒ©ãƒ•ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        function showLoadingState() {
            const loadingElement = document.querySelector('.loading-message');
            if (loadingElement) {
                loadingElement.style.display = 'block';
            }
        }

        function hideLoadingState() {
            const loadingElement = document.querySelector('.loading-message');
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
        }

        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showErrorMessage(message) {
            const errorElement = document.querySelector('.error-message');
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }
        }

        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸éè¡¨ç¤º
        function hideErrorMessage() {
            const errorElement = document.querySelector('.error-message');
            if (errorElement) {
                errorElement.style.display = 'none';
            }
        }

        // è¨­å®šå®Œäº†æ™‚ã®å‡¦ç†
        async function handleSetupCompletion() {
            console.log('=== ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¨­å®šå®Œäº†å‡¦ç† ===');
            
            try {
                // è¨­å®šå®Œäº†é€šçŸ¥ã‚’é€ä¿¡
                const response = await fetch('/api/send-chatwork-notification', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        messageType: 'setup_completion',
                        message: `[info][title]âœ… Metaåºƒå‘Šãƒ¬ãƒãƒ¼ãƒˆãƒ„ãƒ¼ãƒ«è¨­å®šå®Œäº†[/title]
Metaåºƒå‘Šãƒ¬ãƒãƒ¼ãƒˆãƒ„ãƒ¼ãƒ«ã®è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸã€‚

è¨­å®šå†…å®¹:
- Metaåºƒå‘ŠAPI: é€£æºæ¸ˆã¿
- ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šçŸ¥: æœ‰åŠ¹
- è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆ: è¨­å®šæ¸ˆã¿

ä»Šå¾Œã€å®šæœŸãƒ¬ãƒãƒ¼ãƒˆã¨ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ã‚’è‡ªå‹•é€ä¿¡ã„ãŸã—ã¾ã™ã€‚
[/info]`
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    console.log('âœ… è¨­å®šå®Œäº†é€šçŸ¥é€ä¿¡æˆåŠŸ');
                } else {
                    console.error('âŒ è¨­å®šå®Œäº†é€šçŸ¥é€ä¿¡å¤±æ•—:', result.error);
                }
                
            } catch (error) {
                console.error('âŒ è¨­å®šå®Œäº†å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // æ–°ã—ã„ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿å–å¾—æ©Ÿèƒ½
        // ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿
        async function loadCampaigns() {
            try {
                console.log('=== ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿é–‹å§‹ ===');
                const campaignSelect = document.getElementById('selectedCampaign');
                
                const response = await fetch('/api/campaigns');
                const result = await response.json();
                
                if (result.success && result.campaigns) {
                    console.log(`âœ… ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ãƒªã‚¹ãƒˆå–å¾—æˆåŠŸ: ${result.campaigns.length}ä»¶`);
                    
                    // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
                    campaignSelect.innerHTML = '<option value="">å…¨ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³</option>';
                    
                    // ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                    result.campaigns.forEach(campaign => {
                        const option = document.createElement('option');
                        option.value = campaign.id;
                        option.textContent = `${campaign.name} (${campaign.status})`;
                        campaignSelect.appendChild(option);
                    });
                    
                    // å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                    campaignSelect.addEventListener('change', () => {
                        console.log('ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³é¸æŠå¤‰æ›´:', campaignSelect.value);
                        updateDashboardData();
                    });
                    
                } else {
                    console.error('âŒ ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ãƒªã‚¹ãƒˆå–å¾—å¤±æ•—:', result.error);
                    campaignSelect.innerHTML = '<option value="">ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³å–å¾—å¤±æ•—</option>';
                }
            } catch (error) {
                console.error('âŒ ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                const campaignSelect = document.getElementById('selectedCampaign');
                campaignSelect.innerHTML = '<option value="">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</option>';
            }
        }
        
        async function loadDashboardData() {
            try {
                console.log('=== ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹ ===');
                showLoadingState();
                hideErrorMessage();
                
                const response = await fetch('/api/dashboard-data');
                const result = await response.json();
                
                if (result.success) {
                    updateDashboard(result.data);
                    console.log('âœ… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æ›´æ–°å®Œäº†');
                } else {
                    showErrorMessage('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
                    console.error('âŒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—:', result.message);
                }
            } catch (error) {
                showErrorMessage('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                console.error('âŒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            } finally {
                hideLoadingState();
            }
        }

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°é–¢æ•°
        function updateDashboard(data) {
            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¦‚è¦ã‚’æ›´æ–°
            if (data.performance && data.performance.length > 0) {
                const perf = data.performance[data.performance.length - 1];
                
                // ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°
                updateMetricCard('spend', formatCurrency(perf.spend || 0));
                updateMetricCard('impressions', formatNumber(perf.impressions || 0));
                updateMetricCard('clicks', formatNumber(perf.clicks || 0));
                updateMetricCard('ctr', (perf.ctr || 0) + '%');
                updateMetricCard('cpm', formatCurrency(perf.cpm || 0));
                updateMetricCard('cpc', formatCurrency(perf.cpc || 0));
            }
            
            // ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¸€è¦§ã‚’æ›´æ–°
            updateCampaignsList(data.campaigns);
            
            // ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚’æ›´æ–°
            updateInsightsList(data.insights);
            
            // æœ€çµ‚æ›´æ–°æ™‚é–“ã‚’æ›´æ–°
            updateLastUpdateTime(data.lastUpdate);
        }

        // ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ›´æ–°
        function updateMetricCard(type, value) {
            const card = document.querySelector(`.metric-card.${type}`);
            if (card) {
                const valueElement = card.querySelector('.metric-value');
                if (valueElement) {
                    valueElement.textContent = value;
                }
            }
        }

        // ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¸€è¦§æ›´æ–°
        function updateCampaignsList(campaigns) {
            const campaignsContainer = document.getElementById('campaigns-list');
            if (!campaignsContainer) return;
            
            campaignsContainer.innerHTML = '';
            
            if (campaigns && campaigns.length > 0) {
                campaigns.forEach(campaign => {
                    const campaignElement = document.createElement('div');
                    campaignElement.className = 'campaign-item';
                    campaignElement.innerHTML = `
                        <div class="campaign-name">${campaign.name}</div>
                        <div class="campaign-status status-${campaign.status.toLowerCase()}">${campaign.status}</div>
                        <div class="campaign-objective">${campaign.objective}</div>
                    `;
                    campaignsContainer.appendChild(campaignElement);
                });
            } else {
                campaignsContainer.innerHTML = '<p>ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>';
            }
        }

        // ã‚¤ãƒ³ã‚µã‚¤ãƒˆä¸€è¦§æ›´æ–°
        function updateInsightsList(insights) {
            const insightsContainer = document.getElementById('insights-list');
            if (!insightsContainer) return;
            
            insightsContainer.innerHTML = '';
            
            if (insights && insights.length > 0) {
                insights.forEach(insight => {
                    const insightElement = document.createElement('div');
                    insightElement.className = `insight-item ${insight.type}`;
                    insightElement.innerHTML = `
                        <div class="insight-message">${insight.message}</div>
                    `;
                    insightsContainer.appendChild(insightElement);
                });
            } else {
                insightsContainer.innerHTML = '<p>ç¾åœ¨ã€ç‰¹ã«æ”¹å–„ç‚¹ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
            }
        }

        // æœ€çµ‚æ›´æ–°æ™‚é–“æ›´æ–°
        function updateLastUpdateTime(lastUpdate) {
            const lastUpdateElement = document.getElementById('last-update');
            if (lastUpdateElement && lastUpdate) {
                lastUpdateElement.textContent = new Date(lastUpdate).toLocaleString('ja-JP');
            }
        }

        // é€šè²¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatCurrency(amount) {
            return new Intl.NumberFormat('ja-JP', {
                style: 'currency',
                currency: 'JPY'
            }).format(amount);
        }

        // æ•°å€¤ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatNumber(num) {
            return new Intl.NumberFormat('ja-JP').format(num);
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§è¨­å®šå®Œäº†ãƒ•ãƒ©ã‚°ã‚’ãƒã‚§ãƒƒã‚¯
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('setup_completed') === 'true') {
                handleSetupCompletion();
            }
            
            // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
            loadDashboardData();
            
            // 5åˆ†ã”ã¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
            setInterval(loadDashboardData, 5 * 60 * 1000);
        });
    </script>
</body>
</html>

