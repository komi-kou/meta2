<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¹å–„æ–½ç­– - Metaåºƒå‘Šãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        /* æ”¹å–„æ–½ç­–ãƒšãƒ¼ã‚¸å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .app-container {
            display: flex;
            min-height: 100vh;
            background: #f5f6fa;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            background-color: #f9fafb;
        }

        .strategies-page {
            max-width: 1000px;
            margin: 0 auto;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 16px 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .page-header h2 {
            margin: 0;
            color: #374151;
            font-size: 24px;
            font-weight: 600;
        }

        .header-info {
            color: #6b7280;
            font-size: 14px;
        }

        .no-content {
            text-align: center;
            padding: 60px 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .no-content-icon {
            font-size: 48px;
            margin-bottom: 16px;
            display: block;
        }

        .no-content h3 {
            color: #059669;
            margin: 0;
            font-size: 18px;
        }

        .content-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* ã‚¢ãƒ©ãƒ¼ãƒˆå†…å®¹é¢¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .alert-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .alert-header {
            background-color: #dbeafe;
            padding: 14px 16px;
            border-bottom: 1px solid #3b82f6;
        }

        .alert-title-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .alert-icon {
            font-size: 18px;
            margin-right: 8px;
        }

        .alert-metric {
            font-weight: 600;
            color: #1e40af;
            font-size: 16px;
        }

        .alert-timestamp {
            color: #1d4ed8;
            font-size: 12px;
        }

        .alert-message-row {
            color: #1e40af;
            font-size: 14px;
            line-height: 1.4;
        }

        .alert-content {
            padding: 0;
        }

        .strategy-item {
            padding: 14px 16px;
            border-bottom: 1px solid #f3f4f6;
            background-color: #f0f9ff;
        }

        .strategy-item:last-child {
            border-bottom: none;
        }

        .item-priority {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .priority-indicator {
            margin-right: 8px;
            font-size: 16px;
        }

        .priority-text {
            font-weight: 500;
            color: #374151;
            flex: 1;
        }

        .item-timestamp {
            color: #6b7280;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .strategy-actions {
            color: #374151;
            font-size: 14px;
        }

        .action-item {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .action-item:last-child {
            margin-bottom: 0;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                padding: 10px;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .alert-title-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>Metaåºƒå‘Šãƒ¬ãƒãƒ¼ãƒˆ</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="/dashboard" class="nav-item">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
                <a href="/alerts" class="nav-item">ã‚¢ãƒ©ãƒ¼ãƒˆå†…å®¹</a>
                <a href="/alert-history" class="nav-item">ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´</a>
                <a href="/improvement-tasks" class="nav-item">ç¢ºèªäº‹é …</a>
                <a href="/improvement-strategies" class="nav-item active">æ”¹å–„æ–½ç­–</a>
                <a href="/chatwork-test" class="nav-item">ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆ</a>
            </nav>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="main-content">
            <div class="strategies-page">
                <div class="page-header">
                    <h2>ğŸ”§ æ”¹å–„æ–½ç­–</h2>
                    <div class="header-info">
                        æ”¹å–„é …ç›®: <span id="strategyCount"><%= improvements ? Object.values(improvements).reduce((total, strategies) => total + strategies.length, 0) : 0 %></span>ä»¶ 
                        æœ€çµ‚æ›´æ–°: <span id="lastUpdateTime"></span>
                    </div>
                </div>

                <div id="content">
                    <!-- ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° -->
                    <% if (improvements && Object.keys(improvements).length > 0) { %>
                        <% Object.entries(improvements).forEach(([category, strategies]) => { %>
                            <div class="alert-card">
                                <div class="alert-header">
                                    <div class="alert-type">
                                        <span class="metric-label">ğŸ”§</span>
                                        <%= category %>
                                    </div>
                                    <div class="alert-time"><%= new Date().toLocaleString('ja-JP') %></div>
                                </div>
                                
                                <div class="alert-section-header">æ”¹å–„æ–½ç­–</div>
                                <div class="alert-improvements">
                                    <ul class="improvement-strategies">
                                        <% strategies.forEach(strategy => { %>
                                            <li><%= strategy %></li>
                                        <% }); %>
                                    </ul>
                                </div>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <div class="no-content">
                            <div class="no-content-icon">âœ…</div>
                            <div class="no-content-text">æ”¹å–„ãŒå¿…è¦ãªé …ç›®ã¯ã‚ã‚Šã¾ã›ã‚“</div>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ”¹å–„æ–½ç­–ã®å®šç¾©
        const improvementRules = {
            'äºˆç®—æ¶ˆåŒ–ç‡': {
                'é…ä¿¡ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª': [
                    'ç®¡ç†ç”»é¢ã®ä¸Šã®é‹ç”¨ã—ã¦ã„ã‚‹ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ãŒç·‘ã§ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã£ã¦ã„ã‚‹ã‹ã€ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’ç¢ºèªã™ã‚‹',
                    'æ±ºæ¸ˆãŒã§ãã¦ãŠã‚‰ãšé…ä¿¡ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã„ãªã„ã‹ã€è«‹æ±‚ã¨æ”¯æ‰•ã„ã‚’ç¢ºèªã™ã‚‹',
                    'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒå¯©æŸ»è½ã¡ã—ã¦ã„ã¦é…ä¿¡ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã„ãªã„ã‹ã€åºƒå‘Šã‚’ç¢ºèªã™ã‚‹'
                ],
                'é…ä¿¡ã™ã‚‹ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒæ¯ã‚Œã¦ã„ã‚‹': [
                    'éå»7æ—¥é–“ãƒ™ãƒ¼ã‚¹ã§CVæ•°ãŒ0ã‚‚ã—ãã¯ç›®æ¨™CPAã«é”ã—ã¦ã„ãªã„ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚’å·®ã—æ›¿ãˆã‚‹'
                ],
                'é…ä¿¡ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ãŒæ‚ªã„ã®ã‹': [
                    'åºƒå‘Šã‚»ãƒƒãƒˆå†…ã®å¹´é½¢ãƒ»æ€§åˆ¥ãƒ»ã‚¨ãƒªã‚¢ãƒ»èˆˆå‘³é–¢å¿ƒãƒ»ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ãƒ»é…ä¿¡åª’ä½“ã‚’åºƒã’ã¦é…ä¿¡ã™ã‚‹ï¼ˆç²å¾—ã§ããªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã«ã¯é…ä¿¡ã—ãªã„ï¼‰',
                    'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’è¤‡è£½ã—ã¦é…ä¿¡ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã‚’å¤‰ãˆã‚‹ï¼ˆè¨­å®šã¯å¤‰ãˆãšã«ï¼‰'
                ]
            },
            'CTR': {
                'é…ä¿¡ã—ã¦ã„ã‚‹ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒåˆºã•ã£ã¦ã„ãªã„oræ¯ã‚Œã¦ã„ã‚‹': [
                    'éå»7æ—¥é–“ãƒ™ãƒ¼ã‚¹ã§äºˆç®—ãŒå¯„ã£ã¦ãŠã‚‰ãšCVã‚‚å–ã‚Œã¦ã„ãªã„ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚’å·®ã—æ›¿ãˆã‚‹',
                    'éå»7æ—¥é–“ãƒ™ãƒ¼ã‚¹ã§äºˆç®—ã¯å¯„ã£ã¦ã„ã‚‹ã‘ã©ç›®æ¨™CPAã«é”ã—ã¦ãŠã‚‰ãšã‚¯ãƒªãƒƒã‚¯ç‡ã‚‚ç›®æ¨™ä»¥ä¸‹ã®ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã¯å·®ã—æ›¿ãˆã‚‹'
                ],
                'ãƒ•ãƒªãƒ¼ã‚¯ã‚¨ãƒ³ã‚·ãƒ¼ãŒ2.5%ä»¥ä¸Šã‚ã‚‹': [
                    'åºƒå‘Šã‚»ãƒƒãƒˆå†…ã®å¹´é½¢ãƒ»æ€§åˆ¥ãƒ»ã‚¨ãƒªã‚¢ãƒ»èˆˆå‘³é–¢å¿ƒãƒ»ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ãƒ»é…ä¿¡åª’ä½“ã‚’åºƒã’ã¦é…ä¿¡ã™ã‚‹ï¼ˆç²å¾—ã§ããªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã«ã¯é…ä¿¡ã—ãªã„ï¼‰',
                    'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’è¤‡è£½ã—ã¦é…ä¿¡ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã‚’å¤‰ãˆã‚‹ï¼ˆè¨­å®šã¯å¤‰ãˆãšã«ï¼‰'
                ],
                'é…ä¿¡ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ãŒè¦‹è¾¼ã¿é¡§å®¢ã§ã¯ãªã„': [
                    'åºƒå‘Šã‚»ãƒƒãƒˆå†…ã®å¹´é½¢ãƒ»æ€§åˆ¥ãƒ»ã‚¨ãƒªã‚¢ãƒ»èˆˆå‘³é–¢å¿ƒãƒ»ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ãƒ»é…ä¿¡åª’ä½“ã‚’ç‹­ã‚ã¦é…ä¿¡ã™ã‚‹ï¼ˆç²å¾—ã§ããªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã«ã¯é…ä¿¡ã—ãªã„ï¼‰',
                    'é¡ä¼¼ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ã‚’æ´»ç”¨ã—ã¦ã€è¦‹è¾¼ã¿å±¤ã®é«˜ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é…ä¿¡ã™ã‚‹'
                ]
            },
            'CPM': {
                'æœ€é©ãªCPMå€¤ã§é…ä¿¡ã§ãã¦ã„ãªã„': [
                    'éå»7æ—¥é–“ãƒ™ãƒ¼ã‚¹ã§CVæ•°ãŒç²å¾—ã§ãã¦ã„ãªã„ã€CPAãŒé«˜é¨°ã—ã¦ã„ã‚‹ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚’å·®ã—æ›¿ãˆã‚‹',
                    'åºƒå‘Šã‚»ãƒƒãƒˆå†…ã®å¹´é½¢ãƒ»æ€§åˆ¥ãƒ»ã‚¨ãƒªã‚¢ãƒ»èˆˆå‘³é–¢å¿ƒãƒ»ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ãƒ»é…ä¿¡åª’ä½“ã‚’ç‹­ã‚ã¦é…ä¿¡ã™ã‚‹ï¼ˆç²å¾—ã§ããªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã«ã¯é…ä¿¡ã—ãªã„ï¼‰',
                    'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’è¤‡è£½ã™ã‚‹'
                ]
            },
            'CV': {
                'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒåˆºã•ã£ã¦ã„ãªã„orã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒæ¯ã‚Œã¦ã„ã‚‹': [
                    'éå»7æ—¥é–“ãƒ™ãƒ¼ã‚¹ã§CVæ•°ãŒç²å¾—ã§ãã¦ã„ãªã„ã€CPAãŒé«˜é¨°ã—ã¦ã„ã‚‹ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚’å·®ã—æ›¿ãˆã‚‹',
                    'éå»7æ—¥é–“ãƒ™ãƒ¼ã‚¹ã§CVãŒã¤ã„ã¦ãŠã‚‰ãšé…ä¿¡ãŒå¯„ã£ã¦ã„ãªã„ï¼ˆäºˆç®—æ¶ˆåŒ–ãŒã§ãã¦ã„ãªã„ï¼‰ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚’å·®ã—æ›¿ãˆã‚‹',
                    'è¨´æ±‚è»¸ãŒé•ã†ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚’é…ä¿¡ã™ã‚‹',
                    'å‹•ç”»åºƒå‘Šã‚’é…ä¿¡ã™ã‚‹'
                ],
                'é…ä¿¡ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ãŒã‚ºãƒ¬ã¦ã„ã‚‹': [
                    'åºƒå‘Šã‚»ãƒƒãƒˆå†…ã®å¹´é½¢ãƒ»æ€§åˆ¥ãƒ»ã‚¨ãƒªã‚¢ãƒ»èˆˆå‘³é–¢å¿ƒãƒ»ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ãƒ»é…ä¿¡åª’ä½“ã‚’ç‹­ã‚ã¦é…ä¿¡ã™ã‚‹ï¼ˆç²å¾—ã§ããªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã«ã¯é…ä¿¡ã—ãªã„ï¼‰',
                    'é¡ä¼¼ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ã‚’æ´»ç”¨ã—ã¦ã€è¦‹è¾¼ã¿å±¤ã®é«˜ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é…ä¿¡ã™ã‚‹',
                    'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’è¤‡è£½ã—ã¦é…ä¿¡ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã‚’å¤‰ãˆã‚‹',
                    'åºƒå‘Šã‚»ãƒƒãƒˆå†…ã®å¹´é½¢ãƒ»æ€§åˆ¥ãƒ»ã‚¨ãƒªã‚¢ãƒ»èˆˆå‘³é–¢å¿ƒãƒ»ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ãƒ»é…ä¿¡åª’ä½“ã‚’åºƒã’ã¦é…ä¿¡ã™ã‚‹ï¼ˆç²å¾—ã§ããªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã«ã¯é…ä¿¡ã—ãªã„ï¼‰'
                ],
                'LPã§é›¢è„±ã•ã‚Œã¦ã„ã‚‹': [
                    'ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã‚’å°å…¥ã—ã¦é›¢è„±ç®‡æ‰€ãŒå¤šã„ã¨ã“ã‚ã‚’æ”¹å–„ã™ã‚‹ï¼ˆclarityãŒãŠã™ã™ã‚ï¼‰',
                    'CTAã®æ–‡è¨€ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¤‰æ›´ã™ã‚‹',
                    'FVã‚’æ”¹å–„ã™ã‚‹'
                ]
            },
            'CPA': {
                'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒåˆºã•ã£ã¦ã„ãªã„orã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒæ¯ã‚Œã¦ã„ã‚‹': [
                    'éå»7æ—¥é–“ãƒ™ãƒ¼ã‚¹ã§CVæ•°ãŒç²å¾—ã§ãã¦ã„ãªã„ã€CPAãŒé«˜é¨°ã—ã¦ã„ã‚‹ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚’å·®ã—æ›¿ãˆã‚‹',
                    'éå»7æ—¥é–“ãƒ™ãƒ¼ã‚¹ã§CVãŒã¤ã„ã¦ãŠã‚‰ãšé…ä¿¡ãŒå¯„ã£ã¦ã„ãªã„ï¼ˆäºˆç®—æ¶ˆåŒ–ãŒã§ãã¦ã„ãªã„ï¼‰ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚’å·®ã—æ›¿ãˆã‚‹',
                    'è¨´æ±‚è»¸ãŒé•ã†ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚’é…ä¿¡ã™ã‚‹',
                    'å‹•ç”»åºƒå‘Šã‚’é…ä¿¡ã™ã‚‹'
                ],
                'é…ä¿¡ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ãŒã‚ºãƒ¬ã¦ã„ã‚‹': [
                    'åºƒå‘Šã‚»ãƒƒãƒˆå†…ã®å¹´é½¢ãƒ»æ€§åˆ¥ãƒ»ã‚¨ãƒªã‚¢ãƒ»èˆˆå‘³é–¢å¿ƒãƒ»ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ãƒ»é…ä¿¡åª’ä½“ã‚’ç‹­ã‚ã¦é…ä¿¡ã™ã‚‹ï¼ˆç²å¾—ã§ããªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã«ã¯é…ä¿¡ã—ãªã„ï¼‰',
                    'é¡ä¼¼ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ã‚’æ´»ç”¨ã—ã¦ã€è¦‹è¾¼ã¿å±¤ã®é«˜ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é…ä¿¡ã™ã‚‹',
                    'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’è¤‡è£½ã—ã¦é…ä¿¡ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã‚’å¤‰ãˆã‚‹',
                    'åºƒå‘Šã‚»ãƒƒãƒˆå†…ã®å¹´é½¢ãƒ»æ€§åˆ¥ãƒ»ã‚¨ãƒªã‚¢ãƒ»èˆˆå‘³é–¢å¿ƒãƒ»ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ãƒ»é…ä¿¡åª’ä½“ã‚’åºƒã’ã¦é…ä¿¡ã™ã‚‹ï¼ˆç²å¾—ã§ããªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã«ã¯é…ä¿¡ã—ãªã„ï¼‰'
                ],
                'å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ãŒé©åˆ‡ã§ã¯ãªã„': [
                    'ãƒ”ã‚¯ã‚»ãƒ«ã‚’ä½œæˆã—ç›´ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å†åº¦å­¦ç¿’ã—ç›´ã™'
                ],
                'LPã§é›¢è„±ã•ã‚Œã¦ã„ã‚‹': [
                    'ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã‚’å°å…¥ã—ã¦é›¢è„±ç®‡æ‰€ãŒå¤šã„ã¨ã“ã‚ã‚’æ”¹å–„ã™ã‚‹ï¼ˆclarityãŒãŠã™ã™ã‚ï¼‰',
                    'CTAã®æ–‡è¨€ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¤‰æ›´ã™ã‚‹',
                    'FVã‚’æ”¹å–„ã™ã‚‹'
                ]
            }
        };

        // ç¢ºèªäº‹é …ãƒªã‚¹ãƒˆï¼ˆchecklistRules.jsã¨åŒæœŸï¼‰
        const checklistItems = {
            'äºˆç®—æ¶ˆåŒ–ç‡': [
                { priority: 1, title: 'é…ä¿¡ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª', description: 'åºƒå‘ŠãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã£ã¦ã„ã‚‹ã‹' },
                { priority: 2, title: 'é…ä¿¡ã™ã‚‹ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒæ¯ã‚Œã¦ã„ã‚‹', description: 'CVæ•°ãŒ0ã‚‚ã—ãã¯ç›®æ¨™CPAã®åˆ°é”ã—ã¦ãŠã‚‰ãšäºˆç®—ã‚‚æ¶ˆåŒ–ã•ã‚Œã¦ã„ãªã„' },
                { priority: 3, title: 'é…ä¿¡ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ãŒæ‚ªã„ã®ã‹', description: 'é…ä¿¡ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ãŒæ‚ªã„ã¨è¡¨ç¤ºã•ã‚Œãªã„ã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹' }
            ],
            'CTR': [
                { priority: 1, title: 'é…ä¿¡ã—ã¦ã„ã‚‹ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒåˆºã•ã£ã¦ã„ãªã„oræ¯ã‚Œã¦ã„ã‚‹', description: 'ã‚ã‚ŠããŸã‚Šã®ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¦‹ã‚‰ã‚Œã¦ã„ãªã„\n7æ—¥é–“ãƒ™ãƒ¼ã‚¹ã§ãšã£ã¨é…ä¿¡ã—ã¦ã„ã¦ã€é£½ãã‚‰ã‚Œã¦ã„ã‚‹' },
                { priority: 2, title: 'ãƒ•ãƒªãƒ¼ã‚¯ã‚¨ãƒ³ã‚·ãƒ¼ãŒ2.5%ä»¥ä¸Šã‚ã‚‹', description: 'åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã°ã‹ã‚Šã«é…ä¿¡ã•ã‚Œã¦ã„ã¦ã€è¦‹é£½ãã‚‰ã‚Œã¦ã„ã‚‹' },
                { priority: 3, title: 'é…ä¿¡ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ãŒè¦‹è¾¼ã¿é¡§å®¢ã§ã¯ãªã„', description: 'ã‚µãƒ¼ãƒ“ã‚¹ã«åˆã£ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã«é…ä¿¡ã•ã‚Œã¦ã„ãªã„ã®ã§ã€ã‚¹ãƒ«ãƒ¼ã•ã‚Œã¦ã„ã‚‹' }
            ],
            'CPM': [
                { priority: 1, title: 'æœ€é©ãªCPMå€¤ã§é…ä¿¡ã§ãã¦ã„ãªã„', description: 'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒåˆºã•ã£ã¦ã„ãªã„ãŸã‚å…¥åŠ›ã—ãŸCPMã‹ã‚‰ä¹–é›¢ã—ã¦ã„ã‚‹\né…ä¿¡ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ãŒæ‚ªã„ãŸã‚å…¥åŠ›ã—ãŸCPMã‹ã‚‰ä¹–é›¢ã—ã¦ã„ã‚‹' }
            ],
            'CV': [
                { priority: 1, title: 'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒåˆºã•ã£ã¦ã„ãªã„orã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒæ¯ã‚Œã¦ã„ã‚‹', description: 'å…¥å£ã®ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã§é­…åŠ›çš„ã«é­…ã›ã‚Œã¦ã„ãªã„oré£½ãã‚‰ã‚Œã¦ã—ã¾ã£ã¦ã„ã‚‹' },
                { priority: 2, title: 'é…ä¿¡ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ãŒã‚ºãƒ¬ã¦ã„ã‚‹', description: 'è³¼å…¥è¦‹è¾¼ã¿ã®ä½ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é…ä¿¡ã•ã‚Œã¦ã„ã‚‹' },
                { priority: 3, title: 'LPã§é›¢è„±ã•ã‚Œã¦ã„ã‚‹', description: 'LPã®å†…å®¹ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆºã•ã£ã¦ã„ãªã„' }
            ],
            'CPA': [
                { priority: 1, title: 'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒåˆºã•ã£ã¦ã„ãªã„orã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒæ¯ã‚Œã¦ã„ã‚‹', description: '' },
                { priority: 2, title: 'é…ä¿¡ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ãŒã‚ºãƒ¬ã¦ã„ã‚‹', description: 'è³¼å…¥è¦‹è¾¼ã¿ã®ä½ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é…ä¿¡ã•ã‚Œã¦ã„ã‚‹' },
                { priority: 3, title: 'å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ãŒé©åˆ‡ã§ã¯ãªã„', description: 'ãƒ”ã‚¯ã‚»ãƒ«ã§å­¦ç¿’ã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒèª¤ã£ãŸæ–¹å‘ã«é€²ã‚“ã§ã„ã‚‹' },
                { priority: 4, title: 'LPã§é›¢è„±ã•ã‚Œã¦ã„ã‚‹', description: 'LPã®å†…å®¹ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆºã•ã£ã¦ã„ãªã„' }
            ]
        };

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('=== æ”¹å–„æ–½ç­–ãƒšãƒ¼ã‚¸: åˆæœŸåŒ–é–‹å§‹ ===');
            updateLastUpdateTime();
        });

        // CPAã‚¢ãƒ©ãƒ¼ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
        async function generateCPAAlertMessage(targetCPA) {
            try {
                const dashboardResponse = await fetch('/api/dashboard-data');
                const dashboardData = await dashboardResponse.json();
                
                let currentCPA = targetCPA + 2000; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                if (dashboardData.success && dashboardData.data && dashboardData.data.cpa) {
                    currentCPA = dashboardData.data.cpa;
                }
                
                return `CPAãŒ${targetCPA.toLocaleString()}å††ä»¥ä¸Šã®${Math.round(currentCPA).toLocaleString()}å††ãŒç¶šã„ã¦ã„ã¾ã™`;
            } catch (error) {
                console.error('CPA alert message generation error:', error);
                return `CPAãŒ${targetCPA.toLocaleString()}å††ä»¥ä¸ŠãŒç¶šã„ã¦ã„ã¾ã™`;
            }
        }

        // æ”¹å–„æ–½ç­–ã‚’ç”Ÿæˆï¼ˆå®Ÿéš›ã®ã‚´ãƒ¼ãƒ«è¨­å®šã«åŸºã¥ãï¼‰
        async function generateStrategies() {
            console.log('æ”¹å–„æ–½ç­–ã‚’ç”Ÿæˆé–‹å§‹');
            
            let testAlerts = [];
            
            try {
                console.log('=== æ”¹å–„æ–½ç­–ãƒšãƒ¼ã‚¸: APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾— ===');
                
                // å®Ÿéš›ã®ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ã‹ã‚‰ç¾åœ¨ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å–å¾—
                const alertResponse = await fetch('/api/alert-history');
                console.log('APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:', alertResponse.status);
                
                const alertData = await alertResponse.json();
                console.log('APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å…¨ä½“:', alertData);
                console.log('success:', alertData.success);
                console.log('historyå­˜åœ¨:', !!alertData.history);
                console.log('historyé•·ã•:', alertData.history ? alertData.history.length : 'undefined');
                
                if (alertData.success && alertData.history && alertData.history.length > 0) {
                    // APIã‹ã‚‰å–å¾—ã—ãŸå®Ÿéš›ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ä½¿ç”¨
                    testAlerts = alertData.history.slice(0, 10); // æœ€æ–°10ä»¶
                    console.log('âœ… å®Ÿéš›ã®APIã‚¢ãƒ©ãƒ¼ãƒˆã‚’ä½¿ç”¨:', testAlerts.length + 'ä»¶');
                    console.log('ã‚¢ãƒ©ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿è©³ç´°:', testAlerts.map(a => ({ 
                        metric: a.metric, 
                        checkItems: a.checkItems ? a.checkItems.length : 0,
                        improvements: a.improvements ? Object.keys(a.improvements).length : 0,
                        status: a.status,
                        id: a.id
                    })));
                    
                    // å„ã‚¢ãƒ©ãƒ¼ãƒˆã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›
                    testAlerts.forEach((alert, index) => {
                        console.log(`ã‚¢ãƒ©ãƒ¼ãƒˆ${index + 1} (${alert.metric}):`, {
                            checkItems: alert.checkItems,
                            improvements: alert.improvements
                        });
                    });
                } else {
                    console.log('ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ©ãƒ¼ãƒˆãªã—ã€æ”¹å–„æ–½ç­–ãªã—çŠ¶æ…‹');
                    testAlerts = []; // ã‚¢ãƒ©ãƒ¼ãƒˆãªã—çŠ¶æ…‹
                }
                
            } catch (error) {
                console.error('è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚¢ãƒ©ãƒ¼ãƒˆãªã—çŠ¶æ…‹
                testAlerts = [];
            }

            const generatedStrategies = [];
            
            // é‡è¤‡ã‚’é˜²ããŸã‚ã®ãƒ¡ãƒˆãƒªãƒƒã‚¯åˆ¥å‡¦ç†
            const processedMetrics = new Set();
            
            testAlerts.forEach(alert => {
                const metric = alert.metric;
                
                // æ—¢ã«å‡¦ç†æ¸ˆã¿ã®ãƒ¡ãƒˆãƒªãƒƒã‚¯ã¯ã‚¹ã‚­ãƒƒãƒ—
                if (processedMetrics.has(metric)) {
                    return;
                }
                processedMetrics.add(metric);
                
                // APIã‹ã‚‰å–å¾—ã—ãŸç¢ºèªäº‹é …ã¨æ”¹å–„æ–½ç­–ã‚’å„ªå…ˆä½¿ç”¨
                let items = [];
                let improvements = {};
                
                if (alert.checkItems && Array.isArray(alert.checkItems) && alert.checkItems.length > 0) {
                    items = alert.checkItems;
                    console.log(`âœ… ${metric}: APIã®checkItemsã‚’ä½¿ç”¨ (${items.length}ä»¶)`);
                } else {
                    items = checklistItems[metric] || [];
                    console.log(`âš ï¸ ${metric}: ãƒ­ãƒ¼ã‚«ãƒ«checklistItemsã‚’ä½¿ç”¨ (${items.length}ä»¶)`);
                }
                
                if (alert.improvements && typeof alert.improvements === 'object' && Object.keys(alert.improvements).length > 0) {
                    improvements = alert.improvements;
                    console.log(`âœ… ${metric}: APIã®improvementsã‚’ä½¿ç”¨ (${Object.keys(improvements).length}ä»¶)`);
                } else {
                    improvements = improvementRules[metric] || {};
                    console.log(`âš ï¸ ${metric}: ãƒ­ãƒ¼ã‚«ãƒ«improvementRulesã‚’ä½¿ç”¨ (${Object.keys(improvements).length}ä»¶)`);
                }
                
                console.log(`${metric} - ç¢ºèªäº‹é …:`, items);
                console.log(`${metric} - æ”¹å–„æ–½ç­–:`, improvements);
                
                items.forEach(item => {
                    const actions = improvements[item.title] || [];
                    console.log(`"${item.title}" ã«å¯¾ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:`, actions);
                    
                    if (actions.length > 0) {
                        generatedStrategies.push({
                            metric: metric,
                            alertMessage: alert.message,
                            alertLevel: alert.severity || alert.level,
                            timestamp: alert.timestamp,
                            checklistTitle: item.title,
                            priority: item.priority,
                            actions: actions
                        });
                    }
                });
            });

            // æ”¹å–„æ–½ç­–æ•°ã‚’æ›´æ–°
            document.getElementById('strategyCount').textContent = generatedStrategies.length;
            
            console.log('ç”Ÿæˆã•ã‚ŒãŸæ”¹å–„æ–½ç­–:', generatedStrategies);
            renderStrategies(generatedStrategies);
        }

        // æ”¹å–„æ–½ç­–ã‚’è¡¨ç¤º
        function renderStrategies(strategies) {
            const contentDiv = document.getElementById('content');
            
            if (strategies.length === 0) {
                contentDiv.innerHTML = `
                    <div class="no-content">
                        <div class="no-content-icon">âœ…</div>
                        <h3>æ”¹å–„ãŒå¿…è¦ãªé …ç›®ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</h3>
                    </div>
                `;
            } else {
                const strategiesHTML = strategies.map((strategy, index) => `
                    <div class="alert-card">
                        <!-- ã‚¢ãƒ©ãƒ¼ãƒˆå†…å®¹ã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                        <div class="alert-header">
                            <div class="alert-title-row">
                                <span class="alert-icon">ğŸ”§</span>
                                <span class="alert-metric">${strategy.metric}</span>
                                <span class="alert-timestamp">
                                    ${new Date(strategy.timestamp).toLocaleString('ja-JP')}
                                </span>
                            </div>
                            <div class="alert-message-row">
                                ${strategy.alertMessage}
                            </div>
                        </div>

                        <!-- æ”¹å–„æ–½ç­–å†…å®¹ -->
                        <div class="alert-content">
                            <div class="strategy-item">
                                <div class="item-priority">
                                    <span class="priority-indicator">ğŸ”§</span>
                                    <span class="priority-text">${strategy.checklistTitle}</span>
                                </div>
                                <div class="item-timestamp">
                                    ${new Date(strategy.timestamp).toLocaleString('ja-JP')}
                                </div>
                                <div class="strategy-actions">
                                    ${strategy.actions.map((action, actionIndex) => `
                                        <div class="action-item">
                                            ${actionIndex + 1}. ${action}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                contentDiv.innerHTML = strategiesHTML;
            }
        }

        // æœ€çµ‚æ›´æ–°æ™‚é–“ã‚’æ›´æ–°
        function updateLastUpdateTime() {
            document.getElementById('lastUpdateTime').textContent = new Date().toLocaleString('ja-JP');
        }

        // 10ç§’ã”ã¨ã«æ›´æ–°
        setInterval(() => {
            updateLastUpdateTime();
        }, 10 * 1000);
    </script>
</body>
</html> 